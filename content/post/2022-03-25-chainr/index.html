---
title: R社交网络分析包在传染病传播链可视化的应用
author: Luo Fei
date: '2022-03-25'
slug: chainR
categories:
  - Tec
  - 中文
tags:
  - R
  - Tec
output:
    blogdown::html_page:
        number_sections: false 
math: true
showToc: true
TocOpen: false
toc-title: "目录"
draft: false
hidemeta: false
comments: false
description: "跨专业的尝试"
canonicalURL: ""
disableShare: false
hideSummary: false
searchHidden: false
ShowReadingTime: false
ShowBreadCrumbs: true
ShowPostNavLinks: true
cover:
    image: "" # image path/url
    alt: "<alt text>" # alt text
    caption: "<text>" # display caption under cover
    relative: false # when using page bundles set this to true
    hidden: true # only hide on current single page    
---

<script src="{{< blogdown/postref >}}index_files/htmlwidgets/htmlwidgets.js"></script>
<script src="{{< blogdown/postref >}}index_files/d3/d3.min.js"></script>
<script src="{{< blogdown/postref >}}index_files/forceNetwork-binding/forceNetwork.js"></script>
<script src="{{< blogdown/postref >}}index_files/sankey/sankey.js"></script>
<script src="{{< blogdown/postref >}}index_files/sankeyNetwork-binding/sankeyNetwork.js"></script>


<div id="初衷" class="section level2">
<h2>初衷</h2>
<p>在这次疫情处理过程中，了解到在梳理传播链的过程中，很多时候仍然是手工在<code>powerpoint</code>等软件绘制传播链的。采用这种方式的优点能够在图中根据设计者需要加入较多的信息，比如：人员大致位置分布，接触的途径和强度等信息。不足之处在于，<strong>在链条上节点（感染者）较少的时候还能够梳理得很明确，但一旦节点达到一定数量，其中关系复杂度将呈几何倍数增加</strong>（比如1人传多个，1人与多个感染者有接触之类）。</p>
<p>在这种情况下。单纯的手工整理，将耗费非常多的脑力。最严重的缺点是，当现场流调信息变更，对链条进行修订的时，其中一个节点或链接的变化，会因连锁作用导致整个链条的变化。节点越多，变化的影响范围越大，越复杂，就像整理线头一样。当感染者人数上升到一定数量时，手动整理已经变成了一件难以完成的事情。由于本人对R的热衷，探索了一下能不能使用软件<strong>自动化链</strong><del>就是自己懒嘛</del>的方式绘制传播，使用<code>igraph</code>，<code>ggraph</code>和<code>networkD3</code>最终效果如下面几张图,个人觉得还是<code>networkD3</code>炫酷的互动效果最好。</p>
</div>
<div id="具体制作过程" class="section level1">
<h1>具体制作过程</h1>
<p>参见我使用的3个包的说明。。。。。详细步骤待补充。</p>
<div id="数据" class="section level2">
<h2>数据</h2>
<div id="节点数据" class="section level3">
<h3>节点数据</h3>
<p>节点数据里面只需要包含所有感染者的基本信息，比如编号，姓名，类别等等。</p>
</div>
<div id="边数据" class="section level3">
<h3>边数据</h3>
<p>边数据最基础的要求为，节点数据左右感染者的对应关系，简单说就像Excel两列，第一列<code>from</code>， 第二列<code>to</code>，代表每一行两个感染者的关系，从谁传播到谁，当然这些资料需要辛苦在现场的流调专家们提供。</p>
</div>
</div>
<div id="可视化" class="section level2">
<h2>可视化</h2>
<div id="igraph" class="section level3">
<h3>igraph</h3>
<p>首先使用<code>graph_from_data_frame(d =line, vertices = node,  directed = T)</code>将节点和边转换成<code>igraph</code>，就可以直接<code>plot</code>第一张图, 参数自己可以调节。</p>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-4-1.png" width="1920" style="display: block; margin: auto;" /></p>
</div>
<div id="netwokd3" class="section level3">
<h3>netwokd3</h3>
<p>个人最喜欢的效果，使用<code>igraph_to_networkD3</code>命令，将<code>igraph</code>数据转换一下，就可以使用<code>simpleNetwork</code>,<code>forceNetwork</code>，<code>sankeyNetwork(</code>画出交互性网络图了。试验了下，手机浏览器一样可以互动，包括拖动节点，放大，移动等，非常棒的体验。</p>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="forceNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"links":{"source":[2,8,10,12,3,7,56,2,14,13,1,56,0,2,2,2,2,3,4,5,6,7,7,1,56,1,9,2,11,6,24,3,56,7,12,12,1,12,12,6,7,10,15,15,7,28,30,12,7,56,16,14,14,17,37,18,53,2,56,1,5,3,6],"target":[10,11,12,12,13,14,15,16,17,18,19,19,1,20,21,22,23,24,25,26,27,28,29,2,2,30,31,32,33,34,35,35,36,37,38,39,3,40,41,42,43,44,45,46,47,47,47,48,49,4,50,51,52,53,53,54,55,5,6,7,8,9,9],"value":[8,4,8,3,8,8,4,8,8,4,8,3,3,8,8,8,8,8,8,8,8,8,8,8,3,4,8,8,8,8,3,8,4,8,6,8,3,8,8,8,8,8,8,8,8,3,3,8,8,4,8,8,8,8,3,8,4,8,4,4,8,4,2],"colour":["#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666"]},"nodes":{"name":["0号","1号","2号","3号","4号","5号","6号","7号","8号","9号","10号","11号","12号","13号","14号","15号","16号","17号","18号","19号","20号","21号","22号","23号","24号","25号","26号","27号","28号","29号","30号","31号","32号","33号","34号","35号","36号","37号","38号","39号","40号","41号","42号","43号","44号","45号","46号","47号","48号","49号","50号","51号","52号","53号","54号","55号","56号"],"group":[2,2,2,1,7,2,1,6,5,1,2,5,8,4,3,9,2,3,4,2,2,2,2,2,1,7,2,1,6,6,6,1,2,5,1,1,2,3,8,8,8,8,1,6,2,9,9,6,8,6,2,3,3,3,4,3,2],"nodesize":[200,150,30.6,34,35.6,43.1,40.5,10.8,46.9,44.5,42.8,46.8,22.8,27.3,25.4,18.7,11,14.2,23.1,12.4,31.3,11.1,21.7,11.6,11.2,1.3,24,48.2,33.1,2.9,29.2,15.5,45.1,38,23.8,44.4,32.7,15,36,41.2,4.8,22.9,1.6,38.9,41.1,38.6,43.3,9.9,2.1,46.1,12,42.3,1.8,18.9,40.6,27.9,20]},"options":{"NodeID":"name","Group":"group","colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":12,"fontFamily":"serif","clickTextSize":30,"linkDistance":50,"linkWidth":"function(d) { return Math.sqrt(d.value); }","charge":-30,"opacity":2,"zoom":true,"legend":false,"arrows":true,"nodesize":true,"radiusCalculation":" Math.sqrt(d.nodesize)+6","bounded":false,"opacityNoHover":1,"clickAction":null}},"evals":[],"jsHooks":[]}</script>
<div id="htmlwidget-2" style="width:672px;height:480px;" class="sankeyNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"links":{"source":[2,8,10,12,3,7,56,2,14,13,1,56,0,2,2,2,2,3,4,5,6,7,7,1,56,1,9,2,11,6,24,3,56,7,12,12,1,12,12,6,7,10,15,15,7,28,30,12,7,56,16,14,14,17,37,18,53,2,56,1,5,3,6],"target":[10,11,12,12,13,14,15,16,17,18,19,19,1,20,21,22,23,24,25,26,27,28,29,2,2,30,31,32,33,34,35,35,36,37,38,39,3,40,41,42,43,44,45,46,47,47,47,48,49,4,50,51,52,53,53,54,55,5,6,7,8,9,9],"value":[8,4,8,3,8,8,4,8,8,4,8,3,3,8,8,8,8,8,8,8,8,8,8,8,3,4,8,8,8,8,3,8,4,8,6,8,3,8,8,8,8,8,8,8,8,3,3,8,8,4,8,8,8,8,3,8,4,8,4,4,8,4,2]},"nodes":{"name":["0号","1号","2号","3号","4号","5号","6号","7号","8号","9号","10号","11号","12号","13号","14号","15号","16号","17号","18号","19号","20号","21号","22号","23号","24号","25号","26号","27号","28号","29号","30号","31号","32号","33号","34号","35号","36号","37号","38号","39号","40号","41号","42号","43号","44号","45号","46号","47号","48号","49号","50号","51号","52号","53号","54号","55号","56号"],"group":["0号","1号","2号","3号","4号","5号","6号","7号","8号","9号","10号","11号","12号","13号","14号","15号","16号","17号","18号","19号","20号","21号","22号","23号","24号","25号","26号","27号","28号","29号","30号","31号","32号","33号","34号","35号","36号","37号","38号","39号","40号","41号","42号","43号","44号","45号","46号","47号","48号","49号","50号","51号","52号","53号","54号","55号","56号"]},"options":{"NodeID":"name","NodeGroup":"name","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":16,"fontFamily":null,"nodeWidth":15,"nodePadding":10,"units":"Letter(s)","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":20,"sinksRight":true}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="ggraph" class="section level3">
<h3>ggraph</h3>
<p><code>ggraph</code>基本研用了<code>ggplot2</code>绘图的方式，画出来的图也相对更漂亮。首先使用<code>tidygraph</code>包将<code>igraph</code>类型的数据转换为<code>ggraph</code>更合适的元数据。然后可以愉快地使用<code>ggplot2</code>的方式画图了。</p>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
