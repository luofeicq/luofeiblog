---
title: tidyverse系列-purr
author: Luo Fei
date: '2022-11-04'
slug: []
categories:
  - 中文
tags:
  - R
output:
    blogdown::html_page:
        number_sections: true  
        link-citations: true 
math: true
showToc: true
TocOpen: false
toc-title: "目录"
bibliography: ["tidy.bib", "packages.bib"]
biblio-style: "abbrv"
draft: false
hidemeta: false
comments: false
description: "公共卫生医师培训R语言相关"
canonicalURL: ""
disableShare: false
hideSummary: false
searchHidden: false
ShowReadingTime: false
ShowBreadCrumbs: true
ShowPostNavLinks: true
cover:
    image: "tidyverse.png" # image path/url
    alt: "<alt text>" # alt text
    caption: "<text>" # display caption under cover
    relative: false # when using page bundles set this to true
    hidden: true # only hide on current single page  
---



<pre class="r"><code>library(tidyverse)
rm(list = ls())</code></pre>
<p>本系列主要是<sub>又来挖坑</sub>想对<code>tidyverse</code><span class="citation">(<a href="#ref-R-tidyverse" role="doc-biblioref">Wickham 2023</a>)</span>这个整合包的各个包的使用说明做一个完整的中文介绍。本章主要介绍<code>purrr</code>包<span class="citation">(<a href="#ref-R-purrr" role="doc-biblioref">Wickham and Henry 2023</a>)</span>， <code>purrr</code>包通常被称为“优雅的循环迭代包”，它比for循环的速度快，代码更容读。<br />
# <code>map()</code>函数</p>
<div id="一个列表" class="section level2" number="0.1">
<h2><span class="header-section-number">0.1</span> 一个列表</h2>
<ol style="list-style-type: decimal">
<li><code>map(.x, .f, ...)</code>map系列函数会将一个函数应用到输入的列表或向量的每个元素上面，然后返回一个list。比如：</li>
</ol>
<pre class="r"><code>x &lt;- list(1:10, 11:20, 21:30)

l1 &lt;- list(x = c(&quot;a&quot;, &quot;b&quot;), y = c(&quot;c&quot;, &quot;d&quot;))

map(l1, sort, decreasing = T )</code></pre>
<pre><code># $x
# [1] &quot;b&quot; &quot;a&quot;
# 
# $y
# [1] &quot;d&quot; &quot;c&quot;</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><code>map_dbl(.x, .f, ...)</code>返回双精度向量</li>
</ol>
<pre class="r"><code># map_dbl(x, ~ mean(.x, na.rm = T))
map_dbl(x, mean)</code></pre>
<pre><code># [1]  5.5 15.5 25.5</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><code>map_int</code>返回整数向量，注意对于计算结果不是整数的函数，使用<code>map_int</code>程序会报错。</li>
</ol>
<pre class="r"><code>map_int(x, length)</code></pre>
<pre><code># [1] 10 10 10</code></pre>
<ol start="4" style="list-style-type: decimal">
<li><code>map_chr</code>， 返回字符向量。</li>
</ol>
<pre class="r"><code>map_chr(l1, paste, collapse = &quot;,&quot;)</code></pre>
<pre><code>#     x     y 
# &quot;a,b&quot; &quot;c,d&quot;</code></pre>
<ol start="5" style="list-style-type: decimal">
<li><p><code>map_lgl</code>返回逻辑向量</p></li>
<li><p><code>map_dfc</code>返回一个按列合并的数据框，注意对于每一个元素运行候返回的值要长度</p></li>
</ol>
<pre class="r"><code>map_dfc(l1, rep, 3)</code></pre>
<pre><code># # A tibble: 6 × 2
#   x     y    
#   &lt;chr&gt; &lt;chr&gt;
# 1 a     c    
# 2 b     d    
# 3 a     c    
# 4 b     d    
# 5 a     c    
# 6 b     d</code></pre>
<p>对于这个结果感到疑惑的，我们可以单独<code>l1</code>中的元素运行<code>rep</code>看看结果，就更好理解了。</p>
<pre class="r"><code>rep(l1$x,3)</code></pre>
<pre><code># [1] &quot;a&quot; &quot;b&quot; &quot;a&quot; &quot;b&quot; &quot;a&quot; &quot;b&quot;</code></pre>
<pre class="r"><code>rep(l1$y, 3)</code></pre>
<pre><code># [1] &quot;c&quot; &quot;d&quot; &quot;c&quot; &quot;d&quot; &quot;c&quot; &quot;d&quot;</code></pre>
<p>对于<code>map_dfc</code>运行的结果，看作是做了以下操作</p>
<pre class="r"><code>df &lt;- as.data.frame(matrix(nrow = length(l1[[1]]) * 3, ncol = 0))

for (i in 1:length(l1)) {
  df &lt;- bind_cols(df, data.frame(rep(l1[[i]], 3)))
  colnames(df)[[i]] &lt;- names(l1)[[i]]
}
df</code></pre>
<pre><code>#   x y
# 1 a c
# 2 b d
# 3 a c
# 4 b d
# 5 a c
# 6 b d</code></pre>
<ol start="7" style="list-style-type: decimal">
<li><code>map_dfr</code>，返回按行合并的数据框。</li>
</ol>
<pre class="r"><code>map_dfr(x, summary)</code></pre>
<pre><code># # A tibble: 3 × 6
#   Min.        `1st Qu.`   Median      Mean        `3rd Qu.`   Max.       
#   &lt;table[1d]&gt; &lt;table[1d]&gt; &lt;table[1d]&gt; &lt;table[1d]&gt; &lt;table[1d]&gt; &lt;table[1d]&gt;
# 1  1           3.25        5.5         5.5         7.75       10         
# 2 11          13.25       15.5        15.5        17.75       20         
# 3 21          23.25       25.5        25.5        27.75       30</code></pre>
<ol start="8" style="list-style-type: decimal">
<li><code>walk</code>walk 函数并不会返回任何结果，有时仅需要遍历一个数据结构调用函数进行一些显示、绘图， 这称为函数的side effect， 不需要返回结果。比如用cat查看并输出数据框中的变量类别</li>
</ol>
<pre class="r"><code>walk(x, print)</code></pre>
<pre><code>#  [1]  1  2  3  4  5  6  7  8  9 10
#  [1] 11 12 13 14 15 16 17 18 19 20
#  [1] 21 22 23 24 25 26 27 28 29 30</code></pre>
</div>
<div id="两个列表使用map2系列" class="section level2" number="0.2">
<h2><span class="header-section-number">0.2</span> 两个列表使用<code>map2</code>系列</h2>
<ol style="list-style-type: decimal">
<li><code>map2(.x, .f, ...)</code>map函数会将一个函数应用到输入的一对列表或向量的一对元素上面，然后返回一个list。比如：</li>
</ol>
<pre class="r"><code># x &lt;- list(1:10, 11:20, 21:30)
y &lt;- list(1, 2, 3)
z &lt;- list(4, 5, 6)
l2 &lt;- list(x = &quot;a&quot;, y = &quot;z&quot;)
map2(x, y, ~ .x * .y)</code></pre>
<pre><code># [[1]]
#  [1]  1  2  3  4  5  6  7  8  9 10
# 
# [[2]]
#  [1] 22 24 26 28 30 32 34 36 38 40
# 
# [[3]]
#  [1] 63 66 69 72 75 78 81 84 87 90</code></pre>
<pre class="r"><code># list(x[[i]] * y[[i]])</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><code>map2_dbl</code></li>
</ol>
<pre class="r"><code>map2_dbl(y, z, ~ .x / .y)</code></pre>
<pre><code># [1] 0.25 0.40 0.50</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><code>map2_int</code></li>
</ol>
<pre class="r"><code>map2_int(y, z, ~ (length(c(.x) + length(.y))))</code></pre>
<pre><code># [1] 1 1 1</code></pre>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-R-tidyverse" class="csl-entry">
Wickham, Hadley. 2023. <em>Tidyverse: Easily Install and Load the Tidyverse</em>. <a href="https://CRAN.R-project.org/package=tidyverse">https://CRAN.R-project.org/package=tidyverse</a>.
</div>
<div id="ref-R-purrr" class="csl-entry">
Wickham, Hadley, and Lionel Henry. 2023. <em>Purrr: Functional Programming Tools</em>. <a href="https://CRAN.R-project.org/package=purrr">https://CRAN.R-project.org/package=purrr</a>.
</div>
</div>
</div>
